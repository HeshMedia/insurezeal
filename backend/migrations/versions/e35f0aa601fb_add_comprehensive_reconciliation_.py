"""add_comprehensive_reconciliation_tracking_with_field_variations

Revision ID: e35f0aa601fb
Revises: 5c1afbd06690
Create Date: 2025-09-23 00:07:47.823108

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = 'e35f0aa601fb'
down_revision: Union[str, None] = '5c1afbd06690'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('reconciliation_reports', sa.Column('insurer_code', sa.String(length=50), nullable=True))
    
    # Add new_records_added column as nullable first, set default, then make NOT NULL
    op.add_column('reconciliation_reports', sa.Column('new_records_added', sa.Integer(), nullable=True))
    # Update existing records to have a default value of 0
    op.execute("UPDATE reconciliation_reports SET new_records_added = 0 WHERE new_records_added IS NULL")
    # Now make the column NOT NULL
    op.alter_column('reconciliation_reports', 'new_records_added', nullable=False, server_default='0')
    
    op.add_column('reconciliation_reports', sa.Column('reporting_month_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('child_id_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('insurer_broker_code_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('policy_start_date_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('policy_end_date_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('booking_date_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('broker_name_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('insurer_name_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('major_categorisation_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('product_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('product_type_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('plan_type_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('gross_premium_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('gst_amount_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('net_premium_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('od_premium_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('tp_premium_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('policy_number_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('formatted_policy_number_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('registration_no_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('make_model_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('model_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('vehicle_variant_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('gvw_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('rto_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('state_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('cluster_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('fuel_type_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('cc_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('age_year_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('ncb_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('discount_percentage_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('business_type_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('seating_capacity_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('veh_wheels_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('customer_name_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('customer_number_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('commissionable_premium_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('incoming_grid_percentage_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('receivable_from_broker_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('extra_grid_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('extra_amount_receivable_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('total_receivable_from_broker_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('claimed_by_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('payment_by_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('payment_mode_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('cut_pay_amount_received_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('already_given_to_agent_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('actual_agent_po_percentage_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('agent_po_amt_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('agent_extra_percentage_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('agent_extra_amount_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('agent_total_po_amount_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('payment_by_office_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('po_paid_to_agent_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('running_bal_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('total_receivable_gst_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('iz_total_po_percentage_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('as_per_broker_po_percentage_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('as_per_broker_po_amt_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('po_percentage_diff_broker_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('po_amt_diff_broker_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('actual_agent_po_percentage_2_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('as_per_agent_payout_percentage_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('as_per_agent_payout_amount_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('po_percentage_diff_agent_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('po_amt_diff_agent_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('invoice_status_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('invoice_number_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('remarks_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('match_variations', sa.Integer(), nullable=True))
    op.add_column('reconciliation_reports', sa.Column('agent_code_variations', sa.Integer(), nullable=True))
    op.drop_index('idx_reconciliation_reports_status', table_name='reconciliation_reports')
    op.create_index('idx_reconciliation_reports_insurer_code', 'reconciliation_reports', ['insurer_code'], unique=False)
    op.create_index(op.f('ix_reconciliation_reports_insurer_code'), 'reconciliation_reports', ['insurer_code'], unique=False)
    op.drop_column('reconciliation_reports', 'error_details')
    op.drop_column('reconciliation_reports', 'total_errors')
    op.drop_column('reconciliation_reports', 'total_records_added')
    op.drop_column('reconciliation_reports', 'change_details')
    op.drop_column('reconciliation_reports', 'coverage_percentage')
    op.drop_column('reconciliation_reports', 'field_changes')
    op.drop_column('reconciliation_reports', 'file_info')
    op.drop_column('reconciliation_reports', 'status')
    op.drop_column('reconciliation_reports', 'report_type')
    op.drop_column('reconciliation_reports', 'total_records_skipped')
    op.drop_column('reconciliation_reports', 'processing_time_seconds')
    op.drop_column('reconciliation_reports', 'notes')
    op.drop_column('reconciliation_reports', 'file_name')
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column('reconciliation_reports', sa.Column('file_name', sa.VARCHAR(length=255), autoincrement=False, nullable=True))
    op.add_column('reconciliation_reports', sa.Column('notes', sa.TEXT(), autoincrement=False, nullable=True))
    op.add_column('reconciliation_reports', sa.Column('processing_time_seconds', sa.NUMERIC(precision=10, scale=3), autoincrement=False, nullable=False))
    op.add_column('reconciliation_reports', sa.Column('total_records_skipped', sa.INTEGER(), autoincrement=False, nullable=False))
    op.add_column('reconciliation_reports', sa.Column('report_type', sa.VARCHAR(length=50), autoincrement=False, nullable=False))
    op.add_column('reconciliation_reports', sa.Column('status', sa.VARCHAR(length=50), autoincrement=False, nullable=False))
    op.add_column('reconciliation_reports', sa.Column('file_info', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True))
    op.add_column('reconciliation_reports', sa.Column('field_changes', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True))
    op.add_column('reconciliation_reports', sa.Column('coverage_percentage', sa.NUMERIC(precision=5, scale=2), autoincrement=False, nullable=False))
    op.add_column('reconciliation_reports', sa.Column('change_details', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True))
    op.add_column('reconciliation_reports', sa.Column('total_records_added', sa.INTEGER(), autoincrement=False, nullable=False))
    op.add_column('reconciliation_reports', sa.Column('total_errors', sa.INTEGER(), autoincrement=False, nullable=False))
    op.add_column('reconciliation_reports', sa.Column('error_details', postgresql.JSONB(astext_type=sa.Text()), autoincrement=False, nullable=True))
    op.drop_index(op.f('ix_reconciliation_reports_insurer_code'), table_name='reconciliation_reports')
    op.drop_index('idx_reconciliation_reports_insurer_code', table_name='reconciliation_reports')
    op.create_index('idx_reconciliation_reports_status', 'reconciliation_reports', ['status'], unique=False)
    op.drop_column('reconciliation_reports', 'agent_code_variations')
    op.drop_column('reconciliation_reports', 'match_variations')
    op.drop_column('reconciliation_reports', 'remarks_variations')
    op.drop_column('reconciliation_reports', 'invoice_number_variations')
    op.drop_column('reconciliation_reports', 'invoice_status_variations')
    op.drop_column('reconciliation_reports', 'po_amt_diff_agent_variations')
    op.drop_column('reconciliation_reports', 'po_percentage_diff_agent_variations')
    op.drop_column('reconciliation_reports', 'as_per_agent_payout_amount_variations')
    op.drop_column('reconciliation_reports', 'as_per_agent_payout_percentage_variations')
    op.drop_column('reconciliation_reports', 'actual_agent_po_percentage_2_variations')
    op.drop_column('reconciliation_reports', 'po_amt_diff_broker_variations')
    op.drop_column('reconciliation_reports', 'po_percentage_diff_broker_variations')
    op.drop_column('reconciliation_reports', 'as_per_broker_po_amt_variations')
    op.drop_column('reconciliation_reports', 'as_per_broker_po_percentage_variations')
    op.drop_column('reconciliation_reports', 'iz_total_po_percentage_variations')
    op.drop_column('reconciliation_reports', 'total_receivable_gst_variations')
    op.drop_column('reconciliation_reports', 'running_bal_variations')
    op.drop_column('reconciliation_reports', 'po_paid_to_agent_variations')
    op.drop_column('reconciliation_reports', 'payment_by_office_variations')
    op.drop_column('reconciliation_reports', 'agent_total_po_amount_variations')
    op.drop_column('reconciliation_reports', 'agent_extra_amount_variations')
    op.drop_column('reconciliation_reports', 'agent_extra_percentage_variations')
    op.drop_column('reconciliation_reports', 'agent_po_amt_variations')
    op.drop_column('reconciliation_reports', 'actual_agent_po_percentage_variations')
    op.drop_column('reconciliation_reports', 'already_given_to_agent_variations')
    op.drop_column('reconciliation_reports', 'cut_pay_amount_received_variations')
    op.drop_column('reconciliation_reports', 'payment_mode_variations')
    op.drop_column('reconciliation_reports', 'payment_by_variations')
    op.drop_column('reconciliation_reports', 'claimed_by_variations')
    op.drop_column('reconciliation_reports', 'total_receivable_from_broker_variations')
    op.drop_column('reconciliation_reports', 'extra_amount_receivable_variations')
    op.drop_column('reconciliation_reports', 'extra_grid_variations')
    op.drop_column('reconciliation_reports', 'receivable_from_broker_variations')
    op.drop_column('reconciliation_reports', 'incoming_grid_percentage_variations')
    op.drop_column('reconciliation_reports', 'commissionable_premium_variations')
    op.drop_column('reconciliation_reports', 'customer_number_variations')
    op.drop_column('reconciliation_reports', 'customer_name_variations')
    op.drop_column('reconciliation_reports', 'veh_wheels_variations')
    op.drop_column('reconciliation_reports', 'seating_capacity_variations')
    op.drop_column('reconciliation_reports', 'business_type_variations')
    op.drop_column('reconciliation_reports', 'discount_percentage_variations')
    op.drop_column('reconciliation_reports', 'ncb_variations')
    op.drop_column('reconciliation_reports', 'age_year_variations')
    op.drop_column('reconciliation_reports', 'cc_variations')
    op.drop_column('reconciliation_reports', 'fuel_type_variations')
    op.drop_column('reconciliation_reports', 'cluster_variations')
    op.drop_column('reconciliation_reports', 'state_variations')
    op.drop_column('reconciliation_reports', 'rto_variations')
    op.drop_column('reconciliation_reports', 'gvw_variations')
    op.drop_column('reconciliation_reports', 'vehicle_variant_variations')
    op.drop_column('reconciliation_reports', 'model_variations')
    op.drop_column('reconciliation_reports', 'make_model_variations')
    op.drop_column('reconciliation_reports', 'registration_no_variations')
    op.drop_column('reconciliation_reports', 'formatted_policy_number_variations')
    op.drop_column('reconciliation_reports', 'policy_number_variations')
    op.drop_column('reconciliation_reports', 'tp_premium_variations')
    op.drop_column('reconciliation_reports', 'od_premium_variations')
    op.drop_column('reconciliation_reports', 'net_premium_variations')
    op.drop_column('reconciliation_reports', 'gst_amount_variations')
    op.drop_column('reconciliation_reports', 'gross_premium_variations')
    op.drop_column('reconciliation_reports', 'plan_type_variations')
    op.drop_column('reconciliation_reports', 'product_type_variations')
    op.drop_column('reconciliation_reports', 'product_variations')
    op.drop_column('reconciliation_reports', 'major_categorisation_variations')
    op.drop_column('reconciliation_reports', 'insurer_name_variations')
    op.drop_column('reconciliation_reports', 'broker_name_variations')
    op.drop_column('reconciliation_reports', 'booking_date_variations')
    op.drop_column('reconciliation_reports', 'policy_end_date_variations')
    op.drop_column('reconciliation_reports', 'policy_start_date_variations')
    op.drop_column('reconciliation_reports', 'insurer_broker_code_variations')
    op.drop_column('reconciliation_reports', 'child_id_variations')
    op.drop_column('reconciliation_reports', 'reporting_month_variations')
    op.drop_column('reconciliation_reports', 'new_records_added')
    op.drop_column('reconciliation_reports', 'insurer_code')
    # ### end Alembic commands ###
